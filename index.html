<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>LJC CPCC System</title>

<style>
body{
  margin:0;
  background:#0e0e0e;
  display:flex;
  align-items:center;
  justify-content:center;
  height:100vh;
  color:white;
  font-family:Arial;
}
.box{
  background:#1a1a1a;
  padding:30px;
  border-radius:10px;
  width:320px;
  text-align:center;
}
input,button{
  width:100%;
  padding:10px;
  margin-top:10px;
  font-size:16px;
}
button{
  background:#0b5f3c;
  border:none;
  color:white;
  border-radius:5px;
}
.locked{
  opacity:.4;
  pointer-events:none;
}
</style>
</head>

<body>
<div class="box" id="box">
<h2>CPCC Access</h2>
<input type="password" id="pin" placeholder="PIN">
<div id="captchaText"></div>
<input type="text" id="captcha" placeholder="Answer">
<button id="btn" onclick="check()">Enter</button>
<div id="msg"></div>
</div>

<script>
const PIN_HASH="03ac674216f3e15c761ee1a5e255f067953623c8b388b4459e13f978d7c846f4"; // 1123
const LOCK_TIME=30000;
const MAX_FAILS=3;

const token=crypto.randomUUID();
sessionStorage.setItem("session_token",token);

let a=Math.floor(Math.random()*9)+1;
let b=Math.floor(Math.random()*9)+1;
const ans=a+b;
document.getElementById("captchaText").innerText=`${a} + ${b} = ?`;

let startTime=Date.now();

function sha256(str){
  return crypto.subtle.digest("SHA-256",new TextEncoder().encode(str))
    .then(buf=>Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,"0")).join(""));
}

function getFails(){ return Number(sessionStorage.getItem("fails")||0); }
function setFails(v){ sessionStorage.setItem("fails",v); }

function lock(){
  sessionStorage.setItem("locked",Date.now()+LOCK_TIME);
  document.getElementById("box").classList.add("locked");
  document.getElementById("msg").innerText="â›” Locked 30 seconds";
  setTimeout(unlock,LOCK_TIME);
}

function unlock(){
  sessionStorage.removeItem("locked");
  document.getElementById("box").classList.remove("locked");
  document.getElementById("msg").innerText="";
  setFails(0);
}

if(sessionStorage.getItem("locked")){
  if(Date.now()<sessionStorage.getItem("locked")) lock();
  else unlock();
}

async function check(){
  if(sessionStorage.getItem("used")) return;

  if(Date.now()-startTime<1200){
    alert("Bot-like speed");
    return;
  }

  const pin=document.getElementById("pin").value;
  const cap=document.getElementById("captcha").value;

  const hash=await sha256(pin);

  if(hash!==PIN_HASH || Number(cap)!==ans){
    setFails(getFails()+1);
    if(getFails()>=MAX_FAILS) lock();
    alert("Invalid");
    return;
  }

  sessionStorage.setItem("used","1");
  sessionStorage.setItem("cpcc_access","1");
  sessionStorage.setItem("timestamp",Date.now());

  window.location.replace("app.html");
}

// Decoy noise
setInterval(()=>console.log(Math.random()),500);

// Devtools delay
document.addEventListener("contextmenu",e=>e.preventDefault());
document.addEventListener("keydown",e=>{
  if(e.key=="F12"||e.ctrlKey&&e.shiftKey) setTimeout(()=>{},3000);
});
</script>
</body>
</html>
